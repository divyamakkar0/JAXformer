{
    "model": {
        "model_dimension": 768,
        "n_heads": 12,
        "T": 1024,
        "dhR": 128,
        "rope_ratio": 4,
        "vocab_size": 50257,
        "dropout": 0.2,
        "blocks": 12,
        "moe": false,
        "k": 2,
        "n_experts": 4,
        "n_shared": 2,
        "latent_dim": 64,
        "model_dtype": "bfloat16",
        "grad_checkpoint": false
    },
    "data": {
        "train_dataset_path": "./fineweb-edu-10bt-for-gpt2/train",
        "val_dataset_path": "./fineweb-edu-10bt-for-gpt2/test",
        "T": 1024,
        "batch_size": 8
    },
    "lr": {
        "max_lr": 0.004,
        "min_lr": 0,
        "end_lr": 0.0004,
        "warmup_steps": 1000,
        "end_steps": 6000
    },
    "training_steps": 10000,
    "name": "DDP",
    "grad_step": 1,
    "alpha": 0.0001,
    "output_dir": "./results/",
    "checkpoint_steps": 100,
    "checkpoint_manager": "./checkpoints/manager/",
    "inference_batch": 1,
    "eval_steps": 25,
    "seed": 0,
    "wandb": false,
    "grad_clip_norm": 1.0
}
setting up model
Time taken for generation: 8.156639099121094
Model parameter count: 118,952,960 
setting up state & devices
Devices: [CudaDevice(id=0) CudaDevice(id=1)]
setting up dataset
Loaded shard /u5/a26makka/PersonalProj/transformer/fineweb-edu-10bt-for-gpt2/train/fineweb_edu_0036.npy with 199998976 tokens
Loaded shard /u5/a26makka/PersonalProj/transformer/fineweb-edu-10bt-for-gpt2/test/fineweb_edu_0049.npy with 153988320 tokens
train steps: 12207 | val steps: 9399
No checkpoint found, starting from scratch
start training
device 0 [[[-1.06533909e+00  3.16536799e-02  2.36332774e+00 ... -9.54092801e-01
   -1.73816204e+00 -1.81847489e+00]
  [-5.15986383e-01  4.41029072e-01  1.40318644e+00 ... -2.37299657e+00
   -3.62001568e-01  7.72118926e-01]
  [-1.52167332e+00 -1.21395254e+00  7.11748064e-01 ... -1.65271616e+00
    1.44250035e+00  5.26043653e-01]
  ...
  [ 2.24491417e-01 -2.35126793e-01 -6.76850379e-01 ... -1.83123994e+00
   -1.12758838e-01  1.21493077e+00]
  [ 4.48163241e-01 -7.12139785e-01 -1.13600552e+00 ... -1.16311717e+00
    5.60259342e-01 -2.31063545e-01]
  [ 1.54547870e+00  3.11050087e-01 -4.64209288e-01 ... -1.29760051e+00
   -8.24380696e-01 -8.01964402e-01]]

 [[ 1.50004780e+00  1.05166900e+00  2.34114480e+00 ... -5.39774895e-01
   -1.16281295e+00 -6.01717234e-01]
  [ 1.19347107e+00  1.18555874e-01  2.60982823e+00 ... -1.09128690e+00
    8.80280256e-01 -4.10028398e-01]
  [-1.69199169e-01 -1.48959011e-01  2.44415975e+00 ... -1.30195308e+00
   -5.96311353e-02  1.89543009e-01]
  ...
  [ 1.20526421e+00 -1.97415543e+00 -2.17654016e-02 ... -1.18971658e+00
   -6.43012702e-01  5.30607164e-01]
  [ 1.10256624e+00 -1.76557869e-01  1.19332337e+00 ... -2.62685585e+00
    2.99527764e-01  1.31625569e+00]
  [ 1.02286565e+00 -1.79472888e+00 -2.31761232e-01 ... -1.84278572e+00
   -4.81040180e-01  2.99628526e-01]]

 [[-2.87188828e-01  1.00828141e-01  7.96696603e-01 ...  4.96678919e-01
    6.48017287e-01  1.14040568e-01]
  [ 4.65287358e-01 -4.64402169e-01  9.11100686e-01 ...  8.79130960e-01
    1.35819823e-01  1.35702777e+00]
  [-3.15785915e-01 -8.34318548e-02  1.67579865e+00 ... -2.57659733e-01
    6.89816594e-01  7.63181508e-01]
  ...
  [-2.06701398e-01 -6.13291860e-01  4.68817979e-01 ... -1.34203446e+00
   -4.81640339e-01  1.07071854e-01]
  [ 8.65802705e-01 -7.31111884e-01  6.29022598e-01 ... -1.20585382e+00
    1.25846997e-01  1.10420537e+00]
  [ 6.04009390e-01 -1.38791764e+00 -4.22180474e-01 ... -7.64100924e-02
   -1.74083352e-01 -6.49140835e-01]]

 ...

 [[-1.46551251e+00 -1.63278723e+00  7.77630925e-01 ...  8.71599913e-02
    2.23714256e+00 -6.90661669e-01]
  [-9.11075413e-01 -1.73686576e+00  1.59920827e-01 ... -1.60701349e-01
    2.63175583e+00 -8.29519778e-02]
  [-9.28955972e-02 -1.99016309e+00 -4.85294461e-01 ... -1.57003462e+00
    2.18413138e+00 -1.37860686e-01]
  ...
  [ 5.99605858e-01 -5.41378915e-01 -6.65144920e-01 ... -1.11189449e+00
    4.10070986e-01 -4.24748600e-01]
  [ 7.60609284e-04  4.48098779e-03 -1.13975561e+00 ... -8.27281833e-01
    1.73574939e-01  1.63053882e+00]
  [ 1.00380003e+00 -2.25613266e-01 -3.25398594e-01 ... -7.84367025e-01
   -1.15560226e-01  8.35839391e-01]]

 [[ 9.38277483e-01 -3.79407406e-03 -1.25216639e+00 ... -2.64431864e-01
    1.46141016e+00 -5.79590648e-02]
  [ 9.02333319e-01 -1.04536891e+00 -8.44945014e-01 ...  2.29331776e-01
    1.35393512e+00 -9.25153911e-01]
  [-3.09965909e-01 -1.98503524e-01  1.21378613e+00 ... -1.06720400e+00
    1.18492544e+00 -9.60746467e-01]
  ...
  [ 8.74725804e-02 -1.28879654e+00  9.95256186e-01 ... -8.87585655e-02
   -5.90000954e-03  6.17243230e-01]
  [-6.19333446e-01 -1.37283981e+00 -1.46625721e+00 ... -9.16058779e-01
    3.38068694e-01  1.59803820e+00]
  [ 6.40570521e-01 -1.83752477e+00 -2.97377199e-01 ... -2.90403306e-01
    2.37147123e-01  1.01015317e+00]]

 [[ 7.10839450e-01 -3.03266823e-01  6.48428559e-01 ... -7.30749011e-01
   -1.44022274e+00  4.75130618e-01]
  [ 1.36492863e-01 -1.53870296e+00 -3.48875552e-01 ... -1.66062748e+00
   -1.06155121e+00  6.20860517e-01]
  [ 1.46382165e+00 -3.01685899e-01 -2.86914676e-01 ... -1.41885734e+00
   -7.76420355e-01  6.76748276e-01]
  ...
  [ 1.36781251e+00 -1.05990672e+00  1.65824819e+00 ... -8.47989559e-01
   -4.76593614e-01  1.05673552e+00]
  [ 1.56512964e+00 -1.00680530e+00 -1.09032917e+00 ... -1.55336487e+00
   -3.05450678e-01 -6.09448105e-02]
  [ 1.22189307e+00 -1.37359664e-01 -8.13264012e-01 ... -4.65958714e-01
    1.56922626e+00 -1.76537052e-01]]]
device 1 [[[0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  ...
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]]

 [[0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  ...
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]]

 [[0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  ...
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]]

 ...

 [[0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  ...
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]]

 [[0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  ...
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]]

 [[0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  ...
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]
  [0. 0. 0. ... 0. 0. 0.]]]
device 0 11.267123222351074
device 1 10.824905395507812
device 1 11.046014785766602
device 0 11.046014785766602
